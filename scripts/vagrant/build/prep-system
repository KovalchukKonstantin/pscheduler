#!/bin/sh -e
#
# Build up a system for pScheduler development
#
# Args:
#   1 - RHEL Major Version (7 when this was developed)
#

REDHAT_RELEASE_MAJOR="$1"

yum -y upgrade

#
# Repositories
#

# PostgreSQL
yum -y install "https://download.postgresql.org/pub/repos/yum/9.5/redhat/rhel-${REDHAT_RELEASE_MAJOR}Server-$(uname -m)/pgdg-centos95-9.5-3.noarch.rpm"

# EPEL
yum -y install "https://dl.fedoraproject.org/pub/epel/epel-release-latest-${REDHAT_RELEASE_MAJOR}.noarch.rpm"

# perfSONAR
PS_REPO_VERSION=0.8-1
REPO_PREFIX="http://software.internet2.edu/rpms/el${REDHAT_RELEASE_MAJOR}/$(uname -m)/main/RPMS/perfSONAR-repo"
for REPO in "" extras staging
do
    [ "$REPO" != "" ] && REPO="${REPO}-"
    yum -y install "${REPO_PREFIX}-${REPO}${PS_REPO_VERSION}.noarch.rpm"
done


#
# Packages
#

( sed -e 's/\s*#.*$//g; /^$/d' | xargs yum -y install ) <<EOF

# Things needed to build
git
m4     # TODO: Do we still need this?
make
which

# Conveniences
bind-utils
emacs-nox
ntp
pylint
screen
tcsh
tree
wget

EOF
